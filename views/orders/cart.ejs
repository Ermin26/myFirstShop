<% layout('layouts/boilerplate') %>

    <link rel="stylesheet" href="/css/allPages.css">
    <link rel="stylesheet" href="/css/cart.css">
    <script> let stripePK = ` <%= s_pk %> ` </script>
    <div id="myCart" class="myCart mt-5 p-2 justify-content-center text-center">
        <% if(items.length) {%>

            <table class="table p-2">
                <thead>
                    <tr class="text-center">
                        <th class="col border-2 border-bottom">Product</td>
                        <th class="col border-2 border-bottom">Quantity</td>
                        <th class="col border-2 border-bottom">Subtotal</td>
                    </tr>
                </thead>
                <tbody>
                    <% for (product of items) { %>
                        <% for (products of product) { %>
                            <tr>
                                <td>
                                    <div id="cartCard" class="card flex-md-column flex-lg-row">
                                        <div class="card-header ms-auto me-auto m-0 p-0 align-middle"
                                            style="height: 100px; width: 100px;">
                                            <div id="carousel<%= products.sku %>"
                                                class="carousel slide col d-inline-flex ms-auto me-auto">
                                                <div class="carousel-inner">
                                                    <% products.img_link.forEach((img, i)=>{%>
                                                        <div class="carousel-item <%= i === 0 ? 'active' : '' %>">
                                                            <img class="img-fluid rounded" alt="" src="<%= img %>"
                                                                style="height: 100px; width: 100px; min-height: 100px; min-width: 100px">
                                                        </div>
                                                        <% }) %>
                                                </div>
                                                <% if(products.img_link.length> 1) {%>
                                                    <button class="carousel-control-prev" type="button"
                                                        data-bs-target="#carousel<%= products.sku %>"
                                                        data-bs-slide="prev">
                                                        <span class="carousel-control-prev-icon"
                                                            aria-hidden="true"></span>
                                                        <span class="visually-hidden">Previous</span>
                                                    </button>
                                                    <button class="carousel-control-next" type="button"
                                                        data-bs-target="#carousel<%= products.sku %>"
                                                        data-bs-slide="next">
                                                        <span class="carousel-control-next-icon"
                                                            aria-hidden="true"></span>
                                                        <span class="visually-hidden">Next</span>
                                                    </button>
                                                    <% } %>
                                            </div>
                                        </div>
                                        <div class="card-body p-0">
                                            <h5 class="d-inline-block">
                                                <%= products.name %>
                                                    <%= products.color %>
                                            </h5>
                                            <h6>#<%= products.size %>
                                            </h6>
                                        </div>
                                    </div>
                                </td>
                                <td class="col-4 text-center align-middle p-0">
                                    <% for(qty of cart) {%>
                                        <form action="/edit_qty" method="post">
                                            <% if(qty.sku==products.sku) {%>
                                                <input type="hidden" value="<%= products.sku %>" name="id">
                                                <input type="submit" class="bg-light text-dark rounded border-0"
                                                    id="minus" name="minus" value="-">
                                                <input type="text" class="w-25 text-center" id="qty" name="qty"
                                                    value="<%= qty.qty %>" readonly min="1" max="<%= products.qty %>">
                                                <input type="submit" class="bg-light text-dark rounded border-0"
                                                    id="plus" name="plus" value="+">
                                                <% } %>
                                        </form>
                                        <% } %>
                                </td>
                                <td class="col-4 text-center align-middle">
                                    <div class="row row-cols-2 d-inline-flex flex-column flex-md-row g-3">
                                        <div class="col col-md-6">
                                            <h3 class="card-text">
                                                <% for(qty of cart) {%>
                                                    <% if(qty.sku==products.sku) {%>
                                                        <%= qty.qty * qty.price %>€
                                                            <% } %>
                                                                <% } %>
                                            </h3>
                                        </div>

                                        <div class="col col-md-6">
                                            <a class="btn btn-primary btn-sm"
                                                href="/remove/<%=products.sku %> ">Remove</a>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <% } %>
                                <% } %>

                                    <tr>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td class="align-bottom">
                                            <h1>Total</h1>
                                        </td>
                                        <td></td>
                                        <td class="align-bottom">
                                            <h2 class="text-center">
                                                <%= total.toFixed(2) %> €
                                            </h2>
                                        </td>
                                    </tr>
                </tbody>
            </table>
            <div class="pay">


                <form action="/order" method="get">

                    <button class="btn" style="background-color: #e9edc9;">Checkout</button>

                </form>

            </div>
        <%} %>
