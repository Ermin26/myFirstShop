<% layout('layouts/boilerplate') %>
<link rel="stylesheet" href="/css/showOrders.css">


<section>
    <table class="table table-responsive table-hover table-secondary table-bordered align-middle text-center w-100 mt-5">
        <thead>
            <tr>
                <th>#</th>
                <th>Order Id</th>
                <th>Country</th>
                <th>Buyer</th>
                <th>Order date</th>
                <th>Amount</th>
                <th>Print</th>
            </tr>
        </thead>
        <tbody>
            <% for(order of orders) {%>
                <tr class="buttons">
                    <td><input type="checkbox" name="selected" value="<%= order.trackingnum %>"></td>
                    <td><%= order.trackingnum %></td>
                    <td><%= order.country %></td>
                    <td><%= order.name %></td>
                    <td><%= order.date %></td>
                    <td><%= order.costs %></td>
                    <td><button class="printBtn btn btn-success btn-sm" name="<%= order.trackingnum %>" disabled>Print</button></td>
                </tr>
            <% } %>
        </tbody>
    </table>

    <article id="bill" class="mt-5 w-100">
        <div class="row w-100 p-2 m-2">
            <h1>salestershop.si</h1>
        </div>
        <div class="row row-cols-3 d-flex flex-row w-100 ms-auto me-auto">
            <div class="col d-flex flex-column">
                <p>Prejemnik:</p>
                <p id="buyer">Ermin Joldić</p>
                <p id="street">Goriška 22</p>
                <p id="city">2000, Maribor</p>
                <p id="country">SI - Slovenia</p>
            </div>
            <div class="col d-flex flex-column">
                <p>Pošiljatelj</p>
                <p>Salestershop</p>
                <p>Goriška 22</p>
                <p>2000, Maribor</p>
                <p>SI - Slovenia</p>
            </div>
            <div class="col d-flex flex-column">
                <p>Račun št: <strong id="invoiceNumber">1234</strong></p>
                <p>Datum naročila: <strong id="orderDate">01.01.2024</strong></p>
                <p>Kraj izdaje: <strong>Maribor</strong></p>
            </div>
        </div>
        <table id="invoice" class="table table-bordered border-dark text-center w-100 mt-5">
            <thead class="bg-secondary">
                <tr>
                    <th class="p-1">Naziv blaga / storitve</th>
                    <th class="p-1">Cena</th>
                    <th class="p-1">Kol.</th>
                    <th class="p-1">% DDV</th>
                    <th class="p-1">Znesek</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="p-1" colspan="4">Bruto</td>
                    <td class="p-1"><strong>24.99 €</strong></td>
                </tr>
                <tr>
                    <td class="p-1" colspan="4">Popust</td>
                    <td class="p-1"><strong>0.00 €</strong> </td>
                </tr>
                <tr>
                    <td class="p-1" colspan="4">Skupaj</td>
                    <td class="p-1"><strong>24.99 €</strong> </td>
                </tr>
            </tbody>

        </table>
    </article>
</section>



<script>

    const orders = JSON.parse('<%- ordersData %>');
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    const btns = document.querySelectorAll('.printBtn');
    console.log(orders)
    const table = document.getElementById("invoice");
    const tableRows = table.rows.length - 1;

    //console.log("This is table: ", orders.orders[0])

    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('click', function() {
            if(checkbox.checked){
                checkboxes.forEach(cb => {
                if (cb !== checkbox) {
                    cb.checked = false;
                    const rows = table.rows.length - 4;
                    if(rows >= 1){
                        for(let i = 0; i < rows; i++){
                            table.deleteRow(1)
                        }
                    }
                        btns.forEach(btn =>{
                            if(btn.name === checkbox.value){
                                for(order of orders.orders){
                                    if(checkbox.value === order.trackingnum){
                                        const dateOrder = order.date;
                                        document.getElementById('buyer').textContent = order.name;
                                        document.getElementById('street').textContent = order.street;
                                        document.getElementById('city').textContent = order.zip, order.city;
                                        document.getElementById('country').textContent = order.country;
                                        for(let i = 0; i < order.products.length; i++){
                                            let row = table.insertRow(i + 1);
                                            let cell1 = row.insertCell(0)
                                            let cell2 = row.insertCell(1)
                                            let cell3 = row.insertCell(2)
                                            let cell4 = row.insertCell(3)
                                            let cell5 = row.insertCell(4)
                                            cell1.textContent= order.products[i].color + ' ' + order.products[i].size;
                                            cell2.textContent= order.products[i].id;
                                            cell3.textContent= order.products[i].qty;
                                            cell4.textContent= 0.00;
                                            cell5.textContent= 'cena';
                                        }
                                        document.getElementById('invoiceNumber').innerHTML = order.invoice;
                                        document.getElementById('orderDate').textContent = order.date;
                                    }
                                }


                btn.removeAttribute('disabled')

            }else{
                    btn.setAttribute('disabled', 'true');
            }
          })
        }
      });
            }else if(!checkbox.checked){
                btns.forEach(btn =>{
                    btn.setAttribute('disabled','true')
                })
                const rows = table.rows.length - 4;
                for(let i = 0; i < rows; i++){
                    console.log("delam")
                    table.deleteRow(1)
                }
            }
    });
  });
</script>