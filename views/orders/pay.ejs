<% layout('layouts/boilerplate') %>
    <script src="https://js.stripe.com/v3/"></script>
    <script> </script>


    <div class="row row-cols-2 mt-5 g-0">
        <div class="col-7 ms-auto me-auto">
            <div class="info mt-3 mb-4">

            </div>
            <div class="method m-0 p-0 text-center">
                <h3 class="d-inline-flex align-middle p-1">Choose payment method</h3>

            </div>
            <div id="paypal-button-container" class="d-flex m-2 p-2 mt-5"></div>

        </div>

        <div class="col-5">
            <div class="card">
                <div class="d-flex justify-content-between p-2">
                    <h3 class="d-inlines">Shipping Cart</h3>
                    <p class="d-inline-flex"><a href="/cart">Edit</a></p>
                </div>
                <div class="card-body">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Qty</th>
                                <th>Price</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% for(product of cart) {%>
                                <tr>
                                    <td>
                                        <%= product.name%> - <%= product.color%>-#<%= product.size %>
                                    </td>
                                    <td>
                                        <%= product.qty %>
                                    </td>
                                    <td>
                                        <%= product.price %> €
                                    </td>
                                </tr>
                                <% } %>
                        </tbody>
                    </table>

                </div>
                <div class="card-footer d-flex justify-content-between">
                    <div class="col-8 text-start">
                        <ul>
                            <li>Subtotal:</li>
                            <li>Shipping Fee</li>
                            <li><strong>Order Total</strong></li>
                        </ul>
                    </div>
                    <div class="col-4 d-flex flex-column text-end">
                        <strong>0.00 €</strong>
                        <strong>0.00 €</strong>
                        <strong>
                            <%= total %> €
                        </strong>
                    </div>
                </div>
            </div>
        </div>
        <!--
        <button class="btn btn-primary" onclick="purchaseClicked()">Pay</button>
        -->
        <button class="btn btn-outline-success" id="checkout-button">Pay</button>
    </div>


    </div>

    <script>
        // Replace 'YOUR_SERVER_ENDPOINT' with the actual server endpoint
        const serverEndpoint = 'http://localhost:3000/checkout';
  
        const stripe = Stripe('YOUR_STRIPE_PUBLIC_KEY');
  
        document.getElementById('checkout-button').addEventListener('click', async () => {
          const response = await fetch(serverEndpoint, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ amount: 1000 }), // Replace 1000 with your desired amount in cents
          });
  
          const { clientSecret } = await response.json();
  
          const result = await stripe.confirmCardPayment(clientSecret, {
            payment_method: {
              card: stripe.elements.create('card'),
            },
          });
  
          if (result.error) {
            console.error(result.error.message);
          } else {
            console.log('Payment successful!');
          }
        });
      </script>